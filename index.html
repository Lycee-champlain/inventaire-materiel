<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventaire Mat√©riel - Lyc√©e Samuel de Champlain</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .controls {
            padding: 30px;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }

        .search-box {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 15px 20px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .filters {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-size: 14px;
            font-weight: 600;
            color: #495057;
        }

        .filter-select {
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
            min-width: 150px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            padding: 30px;
            background: white;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-card h3 {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-card .number {
            font-size: 36px;
            font-weight: bold;
        }

        .content {
            padding: 30px;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: #6c757d;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        thead th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 14px;
            letter-spacing: 0.5px;
            cursor: pointer;
            user-select: none;
        }

        thead th:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        tbody tr {
            border-bottom: 1px solid #e9ecef;
            transition: background 0.2s;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        tbody td {
            padding: 15px;
            font-size: 14px;
        }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 20px;
            border-radius: 10px;
            margin: 20px;
            border-left: 4px solid #dc3545;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 20px;
            border-radius: 10px;
            margin: 20px;
            border-left: 4px solid #28a745;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #667eea;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 30px;
            cursor: pointer;
            color: #6c757d;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: #dc3545;
        }

        #scanner-container {
            width: 100%;
            margin: 20px 0;
            border-radius: 10px;
            overflow: hidden;
        }

        #scanner-result {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-family: monospace;
            font-size: 16px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .search-box {
                flex-direction: column;
            }

            .search-input {
                min-width: 100%;
            }

            .stats {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 12px;
            }

            tbody td, thead th {
                padding: 10px 8px;
            }
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }

            .controls, .btn, .modal {
                display: none !important;
            }

            .container {
                box-shadow: none;
                border-radius: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì¶ Inventaire Mat√©riel</h1>
            <p>Lyc√©e Samuel de Champlain - Gestion du mat√©riel informatique</p>
        </div>

        <div class="controls">
            <div class="search-box">
                <input 
                    type="text" 
                    id="searchInput" 
                    class="search-input" 
                    placeholder="üîç Rechercher par code, type, salle, marque..."
                >
                <button class="btn btn-primary" onclick="openScanner()">
                    üì∑ Scanner Code-barres
                </button>
                <button class="btn btn-secondary" onclick="resetFilters()">
                    üîÑ R√©initialiser
                </button>
                <button class="btn btn-success" onclick="exportToExcel()">
                    üìä Exporter Excel
                </button>
                <button class="btn btn-primary" onclick="openAddModal()">
                    ‚ûï Ajouter du mat√©riel
                </button>
            </div>

            <div class="filters">
                <div class="filter-group">
                    <label>Type de mat√©riel</label>
                    <select id="filterType" class="filter-select" onchange="applyFilters()">
                        <option value="">Tous les types</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Salle</label>
                    <select id="filterSalle" class="filter-select" onchange="applyFilters()">
                        <option value="">Toutes les salles</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>√âtat</label>
                    <select id="filterEtat" class="filter-select" onchange="applyFilters()">
                        <option value="">Tous les √©tats</option>
                        <option value="Fonctionnel">Fonctionnel</option>
                        <option value="En panne">En panne</option>
                        <option value="En maintenance">En maintenance</option>
                        <option value="R√©form√©">R√©form√©</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="stats" id="stats">
            <div class="stat-card">
                <h3>Total √âquipements</h3>
                <div class="number" id="totalItems">0</div>
            </div>
            <div class="stat-card">
                <h3>Fonctionnels</h3>
                <div class="number" id="functionalItems">0</div>
            </div>
            <div class="stat-card">
                <h3>En Panne</h3>
                <div class="number" id="brokenItems">0</div>
            </div>
            <div class="stat-card">
                <h3>Types</h3>
                <div class="number" id="uniqueTypes">0</div>
            </div>
        </div>

        <div class="content">
            <div id="loadingState" class="loading">
                <div class="spinner"></div>
                <p>Chargement des donn√©es...</p>
            </div>
            <div id="tableContainer" style="display: none;"></div>
        </div>
    </div>

    <div id="scannerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Scanner Code-barres</h2>
                <button class="close-btn" onclick="closeScanner()">&times;</button>
            </div>
            <div id="scanner-container"></div>
            <div id="scanner-result"></div>
        </div>
    </div>

    <div id="addModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ajouter du mat√©riel</h2>
                <button class="close-btn" onclick="closeAddModal()">&times;</button>
            </div>
            <form id="addForm" onsubmit="submitAddForm(event)">
                <div class="form-group">
                    <label>Salle *</label>
                    <input type="text" name="room" required placeholder="Ex: F000, A101...">
                </div>
                <div class="form-group">
                    <label>Type *</label>
                    <select name="type" required>
                        <option value="">-- S√©lectionner --</option>
                        <option value="PC">PC</option>
                        <option value="Ordinateur portable">Ordinateur portable</option>
                        <option value="Vid√©oprojecteur">Vid√©oprojecteur</option>
                        <option value="√âcran interactif">√âcran interactif</option>
                        <option value="Imprimante">Imprimante</option>
                        <option value="Switch">Switch</option>
                        <option value="Serveur">Serveur</option>
                        <option value="Autre">Autre</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Marque *</label>
                    <input type="text" name="brand" required placeholder="Ex: Dell, HP, Epson...">
                </div>
                <div class="form-group">
                    <label>Mod√®le</label>
                    <input type="text" name="model" placeholder="Ex: OptiPlex 7090">
                </div>
                <div class="form-group">
                    <label>N¬∞ de S√©rie *</label>
                    <input type="text" name="serial" required placeholder="Ex: B0D9TRTL3F">
                </div>
                <div class="form-group">
                    <label>Fin de garantie</label>
                    <input type="date" name="warranty">
                </div>
                <div class="form-group">
                    <label>√âtat *</label>
                    <select name="state" required>
                        <option value="Fonctionnel" selected>Fonctionnel</option>
                        <option value="En panne">En panne</option>
                        <option value="En maintenance">En maintenance</option>
                        <option value="R√©form√©">R√©form√©</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Notes</label>
                    <textarea name="notes" rows="3" placeholder="Remarques, observations..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddModal()">Annuler</button>
                    <button type="submit" class="btn btn-success">üíæ Enregistrer</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://unpkg.com/@ericblade/quagga2/dist/quagga.min.js"></script>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyrif6FVRVDuxJtApLdgT5AI2dL6yBStSn1vfdURPBLnx0VeVgQjf-gfDRddHXB7CP9/exec";

        let allData = [];
        let filteredData = [];

        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            setupSearchListener();
        });

        async function loadData() {
            try {
                showLoading(true);
                
                console.log('üîç Chargement depuis:', SCRIPT_URL);
                
                const response = await fetch(`${SCRIPT_URL}?action=load`);
                
                if (!response.ok) {
                    throw new Error(`Erreur HTTP: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('üì¶ Donn√©es re√ßues:', result);
                
                if (result.success) {
                    allData = result.data || [];
                    filteredData = [...allData];
                    
                    console.log(`‚úÖ ${allData.length} √©l√©ments charg√©s`);
                    
                    populateFilters();
                    updateStats();
                    displayTable();
                    showSuccess(`${allData.length} √©quipements charg√©s avec succ√®s`);
                } else {
                    throw new Error(result.error || 'Erreur de chargement');
                }
                
            } catch(error) {
                console.error('‚ùå Erreur:', error);
                showError('Impossible de charger les donn√©es: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        function showLoading(show) {
            document.getElementById('loadingState').style.display = show ? 'block' : 'none';
            document.getElementById('tableContainer').style.display = show ? 'none' : 'block';
        }

        function populateFilters() {
            const types = [...new Set(allData.map(item => item.type).filter(Boolean))];
            const salles = [...new Set(allData.map(item => item.room).filter(Boolean))];

            const typeSelect = document.getElementById('filterType');
            const salleSelect = document.getElementById('filterSalle');

            typeSelect.innerHTML = '<option value="">Tous les types</option>';
            types.sort().forEach(type => {
                typeSelect.innerHTML += `<option value="${type}">${type}</option>`;
            });

            salleSelect.innerHTML = '<option value="">Toutes les salles</option>';
            salles.sort().forEach(salle => {
                salleSelect.innerHTML += `<option value="${salle}">${salle}</option>`;
            });
        }

        function setupSearchListener() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', () => {
                applyFilters();
            });
        }

        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filterType = document.getElementById('filterType').value;
            const filterSalle = document.getElementById('filterSalle').value;
            const filterEtat = document.getElementById('filterEtat').value;

            filteredData = allData.filter(item => {
                const matchSearch = !searchTerm || 
                    Object.values(item).some(val => 
                        String(val).toLowerCase().includes(searchTerm)
                    );
                
                const matchType = !filterType || item.type === filterType;
                const matchSalle = !filterSalle || item.room === filterSalle;
                const matchEtat = !filterEtat || item.state === filterEtat;

                return matchSearch && matchType && matchSalle && matchEtat;
            });

            updateStats();
            displayTable();
        }

        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('filterType').value = '';
            document.getElementById('filterSalle').value = '';
            document.getElementById('filterEtat').value = '';
            applyFilters();
        }

        function updateStats() {
            const functional = filteredData.filter(item => item.state === 'Fonctionnel').length;
            const broken = filteredData.filter(item => item.state === 'En panne').length;
            const types = new Set(filteredData.map(item => item.type).filter(Boolean));

            document.getElementById('totalItems').textContent = filteredData.length;
            document.getElementById('functionalItems').textContent = functional;
            document.getElementById('brokenItems').textContent = broken;
            document.getElementById('uniqueTypes').textContent = types.size;
        }

        function displayTable() {
            const container = document.getElementById('tableContainer');
            
            if (filteredData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                            </path>
                        </svg>
                        <h3>Aucun √©quipement trouv√©</h3>
                        <p>Essayez de modifier vos crit√®res de recherche</p>
                    </div>
                `;
                return;
            }

            const columnMapping = {
                'id': 'ID',
                'room': 'Salle',
                'type': 'Type',
                'brand': 'Marque',
                'model': 'Mod√®le',
                'serial': 'N¬∞ S√©rie',
                'warranty': 'Garantie',
                'state': '√âtat',
                'notes': 'Notes',
                'dateAdded': 'Date Ajout'
            };

            const firstItem = filteredData[0];
            const headers = Object.keys(firstItem);

            let tableHTML = `
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                ${headers.map(header => 
                                    `<th>${columnMapping[header] || header}</th>`
                                ).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredData.map(item => `
                                <tr>
                                    ${headers.map(header => {
                                        let value = item[header] || '';
                                        
                                        if (header === 'state') {
                                            let badgeClass = 'badge-info';
                                            if (value === 'Fonctionnel') badgeClass = 'badge-success';
                                            else if (value === 'En panne') badgeClass = 'badge-danger';
                                            else if (value === 'En maintenance') badgeClass = 'badge-warning';
                                            
                                            return `<td><span class="badge ${badgeClass}">${value}</span></td>`;
                                        }
                                        
                                        if (header === 'dateAdded' && value) {
                                            try {
                                                const date = new Date(value);
                                                value = date.toLocaleDateString('fr-FR');
                                            } catch(e) {}
                                        }
                                        
                                        return `<td>${value}</td>`;
                                    }).join('')}
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;

            container.innerHTML = tableHTML;
        }

        function openScanner() {
            const modal = document.getElementById('scannerModal');
            modal.classList.add('active');
            
            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: document.querySelector('#scanner-container'),
                    constraints: {
                        width: 450,
                        height: 300,
                        facingMode: "environment"
                    },
                },
                decoder: {
                    readers: ["code_128_reader", "ean_reader", "ean_8_reader", "code_39_reader", "upc_reader"]
                }
            }, function(err) {
                if (err) {
                    console.error(err);
                    showError('Impossible d\'acc√©der √† la cam√©ra');
                    return;
                }
                Quagga.start();
            });

            Quagga.onDetected(function(result) {
                const code = result.codeResult.code;
                document.getElementById('scanner-result').innerHTML = `
                    <strong>Code d√©tect√©:</strong> ${code}
                `;
                document.getElementById('searchInput').value = code;
                
                setTimeout(() => {
                    closeScanner();
                    applyFilters();
                }, 1000);
            });
        }

        function closeScanner() {
            Quagga.stop();
            document.getElementById('scannerModal').classList.remove('active');
            document.getElementById('scanner-result').innerHTML = '';
        }

        function exportToExcel() {
            if (filteredData.length === 0) {
                showError('Aucune donn√©e √† exporter');
                return;
            }

            const columnMapping = {
                'id': 'ID',
                'room': 'Salle',
                'type': 'Type',
                'brand': 'Marque',
                'model': 'Mod√®le',
                'serial': 'N¬∞ S√©rie',
                'warranty': 'Garantie',
                'state': '√âtat',
                'notes': 'Notes',
                'dateAdded': 'Date Ajout'
            };

            const headers = Object.keys(filteredData[0]);
            const headersFr = headers.map(h => columnMapping[h] || h);
            
            let csv = headersFr.join(',') + '\n';
            
            filteredData.forEach(item => {
                const row = headers.map(header => {
                    let value = item[header] || '';
                    if (typeof value === 'string' && (value.includes(',') || value.includes('"'))) {
                        value = `"${value.replace(/"/g, '""')}"`;
                    }
                    return value;
                }).join(',');
                csv += row + '\n';
            });

            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', `inventaire_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showSuccess('Export r√©ussi !');
        }

        function showError(message) {
            const container = document.getElementById('tableContainer');
            container.innerHTML = `
                <div class="error-message">
                    <strong>‚ùå Erreur:</strong> ${message}
                </div>
            `;
            container.style.display = 'block';
        }

        function showSuccess(message) {
            const container = document.createElement('div');
            container.className = 'success-message';
            container.innerHTML = `<strong>‚úÖ Succ√®s:</strong> ${message}`;
            
            document.querySelector('.content').insertBefore(
                container, 
                document.getElementById('tableContainer')
            );
            
            setTimeout(() => container.remove(), 3000);
        }

        function openAddModal() {
            document.getElementById('addModal').classList.add('active');
        }

        function closeAddModal() {
            document.getElementById('addModal').classList.remove('active');
            document.getElementById('addForm').reset();
        }

        async function submitAddForm(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            
            const newItem = {
                id: Date.now().toString(),
                room: formData.get('room'),
                type: formData.get('type'),
                brand: formData.get('brand'),
                model: formData.get('model') || '',
                serial: formData.get('serial'),
                warranty: formData.get('warranty') || '',
                state: formData.get('state'),
                notes: formData.get('notes') || '',
                dateAdded: new Date().toISOString()
            };

            try {
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.disabled = true;
                submitBtn.innerHTML = '‚è≥ Enregistrement...';

                const response = await fetch(`${SCRIPT_URL}?action=add`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(newItem)
                });

                const result = await response.json();

                if (result.success) {
                    showSuccess('Mat√©riel ajout√© avec succ√®s !');
                    closeAddModal();
                    loadData(); // Recharger les donn√©es
                } else {
                    throw new Error(result.error || 'Erreur lors de l\'ajout');
                }

            } catch (error) {
                console.error('‚ùå Erreur ajout:', error);
                showError('Impossible d\'ajouter le mat√©riel: ' + error.message);
                
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'üíæ Enregistrer';
            }
        }
    </script>
</body>
</html>
